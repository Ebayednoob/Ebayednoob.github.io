<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial: Arch-Router - Aligning LLM Routing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom scrollbar for a more thematic feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        ::-webkit-scrollbar-thumb {
            background: #0f3d0f;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #1a741a;
        }
    </style>
</head>
<body class="bg-black text-green-500 p-4 sm:p-6 md:p-8" style="font-family: 'Inter', sans-serif;">

    <!-- Header Section -->
    <header class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-green-200 mb-4 tracking-wider">Arch-Router: Aligning LLM Routing with Human Preferences</h1>
        <p class="text-lg text-green-400">An interactive tutorial on a smarter way to route LLM queries.</p>
    </header>

    <!-- Introduction Section -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">1. The Challenge with LLM Routing</h2>
        <p class="text-lg leading-relaxed mb-4">
            We have a growing universe of Large Language Models (LLMs)—some are great at coding, others excel at creative writing, and some are just fast and cheap. The challenge is picking the <span class="font-bold text-green-200">right model</span> for the <span class="font-bold text-green-200">right job</span>.
        </p>
        <div class="bg-gray-900/50 border border-green-900 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-green-300 mb-3">Existing routing methods often fall short because they:</h3>
            <ul class="list-disc list-inside space-y-2 text-green-400">
                <li><span class="font-semibold text-green-300">Ignore Human Preferences:</span> They rely on benchmarks that don't capture subjective qualities like a model's 'style' or 'tone'.</li>
                <li><span class="font-semibold text-green-300">Are Inflexible:</span> They are trained on a fixed set of models. Adding a new, better model often requires complete retraining.</li>
                <li><span class="font-semibold text-green-300">Lack Transparency:</span> It's often a "black box," making it hard to understand why a particular model was chosen.</li>
            </ul>
        </div>
    </section>

    <!-- Core Idea Section -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">2. The Arch-Router Framework</h2>
        <p class="text-lg leading-relaxed mb-6">
            Arch-Router introduces a <span class="font-bold text-green-200">preference-aligned</span> framework. Instead of guessing which model is "best," it lets the user define their preferences through simple, human-readable policies. The router's job is to match the user's query to the right policy.
        </p>

        <div class="bg-gray-900/50 border border-green-900 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-green-300 mb-4">The Mechanism: Decoupled Routing</h3>
            <div class="flex flex-col md:flex-row items-center justify-around space-y-6 md:space-y-0 md:space-x-6">
                <!-- Step 1 -->
                <div class="text-center">
                    <div class="bg-green-900/30 border-2 border-green-700 rounded-full w-24 h-24 flex items-center justify-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
                    </div>
                    <p class="font-bold text-green-200">User Query</p>
                    <p class="text-sm text-green-400">"Fix this Python error"</p>
                </div>
                
                <div class="text-5xl font-thin text-green-600">→</div>

                <!-- Step 2 -->
                <div class="text-center">
                    <div class="bg-green-900/30 border-2 border-green-700 rounded-lg p-4 mb-2">
                        <p class="font-mono text-green-300">Arch-Router</p>
                    </div>
                    <p class="font-bold text-green-200">1. Route Selection</p>
                    <p class="text-sm text-green-400">Matches query to the 'bug_fixing' policy</p>
                </div>

                <div class="text-5xl font-thin text-green-600">→</div>

                <!-- Step 3 -->
                <div class="text-center">
                    <div class="bg-green-900/30 border-2 border-green-700 rounded-full w-24 h-24 flex items-center justify-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V3m0 18v-3m6-6h3m-3 6h3M6 9H3m0 6h3" /></svg>
                    </div>
                    <p class="font-bold text-green-200">2. Model Assignment</p>
                    <p class="text-sm text-green-400">'bug_fixing' policy points to 'GPT-4'</p>
                </div>
            </div>
             <p class="mt-6 text-center text-green-400 leading-relaxed">This decoupling is key. You can swap the model associated with a policy (e.g., change 'bug_fixing' to use 'Claude-3.7-sonnet') <span class="font-bold text-white">without retraining the router</span>.</p>
        </div>
    </section>

    <!-- Interactive Simulator -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">3. Interactive Routing Simulator</h2>
        <div class="bg-gray-900/50 border border-green-900 rounded-lg p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Policies -->
                <div>
                    <h3 class="text-xl font-semibold text-green-300 mb-4">Available Route Policies:</h3>
                    <div id="policies" class="space-y-3">
                        <div id="policy-code_generation" data-keywords="generate,create,write,build,make me a function" class="p-3 bg-gray-800 border border-gray-700 rounded-lg transition-all duration-300">
                            <p class="font-mono font-bold text-green-300">code_generation</p>
                            <p class="text-sm text-green-500">Generate new code snippets, functions, or boilerplate.</p>
                        </div>
                        <div id="policy-bug_fixing" data-keywords="fix,error,bug,doesn't work,debug" class="p-3 bg-gray-800 border border-gray-700 rounded-lg transition-all duration-300">
                            <p class="font-mono font-bold text-green-300">bug_fixing</p>
                            <p class="text-sm text-green-500">Identify and fix errors or bugs in user-supplied code.</p>
                        </div>
                        <div id="policy-code_explanation" data-keywords="explain,what does,how does,understand" class="p-3 bg-gray-800 border border-gray-700 rounded-lg transition-all duration-300">
                            <p class="font-mono font-bold text-green-300">code_explanation</p>
                            <p class="text-sm text-green-500">Explain what a piece of code does, including logic.</p>
                        </div>
                        <div id="policy-performance_optimization" data-keywords="faster,slow,optimize,speed up,efficient" class="p-3 bg-gray-800 border border-gray-700 rounded-lg transition-all duration-300">
                            <p class="font-mono font-bold text-green-300">performance_optimization</p>
                            <p class="text-sm text-green-500">Suggest changes to make code faster or more scalable.</p>
                        </div>
                         <div id="policy-other" data-keywords="hi,hello,thanks,thank you,bye" class="p-3 bg-gray-800 border border-gray-700 rounded-lg transition-all duration-300">
                            <p class="font-mono font-bold text-green-300">other</p>
                            <p class="text-sm text-green-500">For irrelevant queries or simple greetings.</p>
                        </div>
                    </div>
                </div>
                <!-- Simulator -->
                <div>
                    <h3 class="text-xl font-semibold text-green-300 mb-4">Enter Your Query:</h3>
                    <textarea id="query-input" rows="4" class="w-full bg-gray-900 text-green-300 border-2 border-green-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="e.g., 'My javascript code has a bug, can you fix it?'"></textarea>
                    <div class="mt-4 flex space-x-2">
                        <button id="route-button" class="flex-grow bg-green-600 text-black font-bold py-3 px-4 rounded-lg hover:bg-green-500 transition-all duration-300 transform hover:scale-105">
                            Route Query
                        </button>
                        <button id="reset-button" class="w-1/3 bg-gray-700 text-green-300 font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition-all duration-300">
                            Reset
                        </button>
                    </div>
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-green-300">Routing Decision:</h4>
                        <div id="routing-result" class="mt-2 p-4 bg-black border-2 border-dashed border-green-700 rounded-lg h-16 flex items-center justify-center">
                            <p class="text-green-600">Awaiting query...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
     <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">4. How Arch-Router Learns</h2>
        <p class="text-lg leading-relaxed mb-6">
            A model is only as good as its data. Arch-Router is trained on a high-quality, synthetic dataset generated through a clever two-phase pipeline.
        </p>
        <div class="flex flex-col md:flex-row gap-6">
            <!-- Phase 1 -->
            <div class="flex-1 bg-gray-900/50 border border-green-900 rounded-lg p-6">
                <h3 class="text-xl font-bold text-green-300 mb-3">Phase 1: Clean Data Generation</h3>
                <p class="mb-4 text-green-400">An LLM assembly line creates a vast corpus of clean, structured conversations, each perfectly aligned with a specific routing policy.</p>
                <ol class="list-decimal list-inside space-y-2 text-green-400">
                    <li><span class="font-semibold text-green-300">Generate Policies:</span> Create diverse route policies (like the ones above).</li>
                    <li><span class="font-semibold text-green-300">Synthesize Conversations:</span> Generate multi-turn dialogues that match each policy.</li>
                    <li><span class="font-semibold text-green-300">Verify Alignment:</span> Use another LLM to check if the conversation truly matches the policy, ensuring high quality.</li>
                </ol>
            </div>
            <!-- Phase 2 -->
            <div class="flex-1 bg-gray-900/50 border border-green-900 rounded-lg p-6">
                 <h3 class="text-xl font-bold text-green-300 mb-3">Phase 2: Real-World Augmentation</h3>
                <p class="mb-4 text-green-400">To make the model robust, the clean data is "muddied up" with real-world messiness.</p>
                 <ol class="list-decimal list-inside space-y-2 text-green-400">
                    <li><span class="font-semibold text-green-300">Irrelevance Injection:</span> Add off-topic messages to teach the model to ignore noise.</li>
                    <li><span class="font-semibold text-green-300">Policy Modification:</span> Add confusing or overlapping policies to make the decision harder.</li>
                    <li><span class="font-semibold text-green-300">Scenario Mixing:</span> Stitch conversations together to simulate topic shifts and follow-up questions.</li>
                </ol>
            </div>
        </div>
    </section>
    
    <!-- Analysis Section -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">5. Analysis: When Do Routers Fail?</h2>
        <p class="text-lg leading-relaxed mb-6">
            The paper analyzes not just if models fail, but <span class="text-green-200 font-bold">when</span> they fail. This reveals crucial behavioral differences. Below is a simplified visualization of the failure patterns for Arch-Router versus a powerful proprietary model like Claude-Sonnet-3.7.
        </p>
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Arch-Router Analysis -->
            <div class="flex-1 bg-gray-900/50 border border-green-900 rounded-lg p-6">
                <h3 class="text-xl font-semibold text-green-300 mb-4">Arch-Router: Fails Early</h3>
                <p class="text-green-400 mb-4">Arch-Router's failures are front-loaded. It struggles most with ambiguity in the <span class="font-bold text-white">very first turn</span>. If it understands the initial intent, it's very reliable in multi-turn conversations.</p>
                <div class="w-full bg-gray-900 p-2 rounded">
                    <div class="flex items-end h-40 space-x-2">
                        <div class="flex-1 bg-green-500 rounded-t-sm" style="height: 100%;"></div>
                        <div class="flex-1 bg-green-600 rounded-t-sm" style="height: 60%;"></div>
                        <div class="flex-1 bg-green-700 rounded-t-sm" style="height: 45%;"></div>
                        <div class="flex-1 bg-green-800 rounded-t-sm" style="height: 30%;"></div>
                        <div class="flex-1 bg-green-900 rounded-t-sm" style="height: 10%;"></div>
                    </div>
                    <div class="flex text-xs text-green-400 mt-1">
                        <span class="flex-1 text-center">Turn 1</span>
                        <span class="flex-1 text-center">Turn 2</span>
                        <span class="flex-1 text-center">Turn 3</span>
                        <span class="flex-1 text-center">Turn 4</span>
                        <span class="flex-1 text-center">Turn 5+</span>
                    </div>
                    <p class="text-center text-sm font-bold text-green-200 mt-2">Distribution of First-Failure Turn</p>
                </div>
            </div>
            <!-- Claude-Sonnet Analysis -->
            <div class="flex-1 bg-gray-900/50 border border-green-900 rounded-lg p-6">
                <h3 class="text-xl font-semibold text-green-300 mb-4">Proprietary Models: Drift Over Time</h3>
                <p class="text-green-400 mb-4">In contrast, models like Claude-Sonnet-3.7 handle the first turn well but are more likely to fail <span class="font-bold text-white">mid-conversation</span>. They can lose context or misinterpret a nuanced follow-up question.</p>
                 <div class="w-full bg-gray-900 p-2 rounded">
                    <div class="flex items-end h-40 space-x-2">
                        <div class="flex-1 bg-green-700 rounded-t-sm" style="height: 60%;"></div>
                        <div class="flex-1 bg-green-800 rounded-t-sm" style="height: 40%;"></div>
                        <div class="flex-1 bg-green-600 rounded-t-sm" style="height: 70%;"></div>
                        <div class="flex-1 bg-green-700 rounded-t-sm" style="height: 45%;"></div>
                        <div class="flex-1 bg-green-900 rounded-t-sm" style="height: 15%;"></div>
                    </div>
                    <div class="flex text-xs text-green-400 mt-1">
                        <span class="flex-1 text-center">Turn 1</span>
                        <span class="flex-1 text-center">Turn 2</span>
                        <span class="flex-1 text-center">Turn 3</span>
                        <span class="flex-1 text-center">Turn 4</span>
                        <span class="flex-1 text-center">Turn 5+</span>
                    </div>
                    <p class="text-center text-sm font-bold text-green-200 mt-2">Distribution of First-Failure Turn</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Future Directions Section -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold text-green-300 mb-4 border-b-2 border-green-800 pb-2">6. Future Directions: Quaternion-based Semantic Routing</h2>
        <p class="text-lg leading-relaxed mb-6">
            Looking ahead, routing could become even more sophisticated by moving beyond simple classification. One exciting avenue is the use of <span class="font-bold text-green-200">quaternion encoding</span>, a mathematical concept from 3D graphics, to represent policies and queries.
        </p>
        <div class="bg-gray-900/50 border border-green-900 rounded-lg p-6 space-y-4">
           <p class="leading-relaxed text-green-400">Instead of treating policies as separate categories, we can represent them as points in a high-dimensional space. Quaternions would allow us to represent not just their positions, but the <span class="font-bold text-white">relationships and rotations</span> between them.</p>
           <ul class="list-disc list-inside space-y-3 text-green-400">
                <li><span class="font-semibold text-green-200">Efficient Semantic Libraries:</span> A query for "fix my slow code" could be represented as a rotation from "bug_fixing" towards "performance_optimization". This captures nuance far better than simple keywords, creating a fluid semantic library rather than a rigid list of options.</li>
                <li><span class="font-semibold text-green-200">Dynamic Learning and Pruning:</span> The router could learn these "rotation patterns" from user interactions. If many users ask for optimizations after generating code, that rotational pathway is strengthened. Over time, the system would predict user intent transitions, dynamically routing requests by learning efficient pathways and pruning unused ones, leading to a self-improving, predictive routing system.</li>
            </ul>
        </div>
    </section>

    <!-- Conclusion Section -->
    <footer class="mt-12 text-center border-t-2 border-green-800 pt-8">
        <h2 class="text-3xl font-semibold text-green-300 mb-4">Key Takeaways</h2>
        <div class="max-w-4xl mx-auto text-lg text-green-400 space-y-2">
            <p><span class="font-bold text-green-200">Flexibility is Power:</span> Decoupling routing from model selection makes systems more adaptable.</p>
            <p><span class="font-bold text-green-200">Human Preferences Matter:</span> Aligning with user-defined policies leads to more transparent and intuitive routing.</p>
            <p><span class="font-bold text-green-200">Small Can Be Mighty:</span> A compact, specialized model like Arch-Router (1.5B) can outperform large, general-purpose models at a specific task while being much faster and cheaper.</p>
        </div>
         <p class="mt-8 text-sm text-green-600">
            This tutorial is based on the paper <a href="https://arxiv.org/abs/2506.16655" target="_blank" class="text-green-400 hover:text-green-300 underline">Arch-Router: Aligning LLM Routing with Human Preferences</a> by Co Tran, et al.
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const queryInput = document.getElementById('query-input');
            const routeButton = document.getElementById('route-button');
            const resetButton = document.getElementById('reset-button');
            const routingResult = document.getElementById('routing-result');
            const policiesContainer = document.getElementById('policies');
            const policies = Array.from(policiesContainer.children);

            function resetSimulator() {
                queryInput.value = '';
                routingResult.innerHTML = `<p class="text-green-600">Awaiting query...</p>`;
                policies.forEach(p => {
                    p.classList.remove('bg-green-500', 'border-green-300', 'scale-105');
                    p.classList.add('bg-gray-800', 'border-gray-700');
                });
            }

            routeButton.addEventListener('click', () => {
                const query = queryInput.value.toLowerCase().trim();
                
                // Reset styles before processing
                policies.forEach(p => {
                    p.classList.remove('bg-green-500', 'border-green-300', 'scale-105');
                    p.classList.add('bg-gray-800', 'border-gray-700');
                });
                
                if (!query) {
                    routingResult.innerHTML = `<p class="text-yellow-400">Please enter a query.</p>`;
                    return;
                }

                let bestMatch = 'other';
                let maxScore = 0;

                policies.forEach(policyEl => {
                    const id = policyEl.id.replace('policy-', '');
                    if (id === 'other') return; // Skip 'other' for keyword matching initially

                    const keywords = policyEl.dataset.keywords.split(',');
                    let currentScore = 0;
                    keywords.forEach(kw => {
                        if (query.includes(kw)) {
                            currentScore++;
                        }
                    });

                    if (currentScore > maxScore) {
                        maxScore = currentScore;
                        bestMatch = id;
                    }
                });
                
                // Handle greeting case specifically
                const greetingKeywords = ['hi', 'hello', 'thanks', 'thank you', 'bye'];
                if (greetingKeywords.some(kw => query.split(' ').includes(kw))) {
                     if (query.split(' ').length <= 3) {
                        bestMatch = 'other';
                     }
                }

                // Update UI
                const selectedPolicyEl = document.getElementById(`policy-${bestMatch}`);
                if (selectedPolicyEl) {
                    selectedPolicyEl.classList.add('bg-green-500', 'border-green-300', 'scale-105');
                    selectedPolicyEl.classList.remove('bg-gray-800', 'border-gray-700');
                }
                
                routingResult.innerHTML = `<p class="text-2xl font-mono font-bold text-green-300">${bestMatch}</p>`;
            });

            resetButton.addEventListener('click', resetSimulator);
        });
    </script>

</body>
</html>
